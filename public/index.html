<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, maximum-scale=1">
<meta http-equiv="Content-Security-Policy" content="default-src 'self' https: data: blob:; script-src 'self' 'unsafe-inline' https://unpkg.com https://cdn.jsdelivr.net https://cdnjs.cloudflare.com; style-src 'self' 'unsafe-inline' https://unpkg.com; img-src 'self' https: data: blob:; connect-src 'self' https://overpass-api.de https://overpass.kumi.systems https://lz4.overpass-api.de https://nominatim.openstreetmap.org https://commons.wikimedia.org https://*.wikipedia.org https://www.wikidata.org https://*.tile.openstreetmap.org https://*.basemaps.cartocdn.com https://server.arcgisonline.com; object-src 'none'; base-uri 'self'; frame-ancestors 'self';">
<title>KÄ±ble DedektÃ¶rÃ¼</title>

<link rel="stylesheet" href="./vendor/leaflet/leaflet.css"/>
<link rel="stylesheet" href="./assets/css/app.css">
</head>
<body>

<header>
  <div class="brand-home" role="button" tabindex="0" onclick="resetToHome()" onkeydown="if(event.key==='Enter'||event.key===' '){event.preventDefault();resetToHome();}">
    <div><div class="logo-arabic">Ù‚ÙØ¨Ù’Ù„ÙØ©</div></div>
    <div>
      <div class="logo-title">KÄ±ble DedektÃ¶rÃ¼</div>
      <div class="logo-sub">Bina YÃ¶nÃ¼ Analizi</div>
    </div>
  </div>
  <div class="divider"></div>
  <div class="search-box">
    <input id="city-input" list="city-suggest-list" type="text" placeholder="Åehir adÄ±..." value=""/>
    <datalist id="city-suggest-list"></datalist>
    <button class="btn" id="search-btn" data-tip="Åehir ara [Enter]">Ara</button>
    <div class="city-smart-dd" id="city-smart-dd"></div>
  </div>
  <div class="header-actions">
    <div class="header-row">
      <div class="map-switch">
        <button id="btn-dark" class="active" onclick="switchLayer('dark')" data-tip="Koyu harita">ğŸŒ‘ Koyu</button>
        <button id="btn-sat" onclick="switchLayer('satellite')" data-tip="Uydu gÃ¶rÃ¼nÃ¼mÃ¼">ğŸ›° Uydu</button>
        <button id="btn-osm" onclick="switchLayer('osm')" data-tip="Standart harita">ğŸ—º Harita</button>
      </div>
      <button id="btn-heat"    class="btn btn-sm" onclick="toggleHeatmap()"     data-tip="IsÄ± haritasÄ± [H]">ğŸŒ¡ IsÄ±</button>
      <button id="btn-score"   class="btn btn-sm" onclick="toggleScoreCard()"   data-tip="Skor kartÄ± [S]">ğŸ“Š Skor</button>
      <button id="btn-compare" class="btn btn-sm" onclick="openCompare()"       data-tip="Åehir karÅŸÄ±laÅŸtÄ±r [C]">âš–ï¸ KarÅŸÄ±laÅŸtÄ±r</button>
      <button id="btn-history" class="btn btn-sm" onclick="toggleHistoryMode()" data-tip="Tarihsel analiz [T]">ğŸ“… Tarih</button>
      <button id="btn-lb"      class="btn btn-sm" onclick="openLeaderboard()"   data-tip="KÃ¼resel sÄ±ralama [L]">ğŸŒ SÄ±ralama</button>
      <button id="btn-district" class="btn btn-sm" data-tip="Ä°lÃ§e modu (hover + tÄ±kla)">ğŸ§© Ä°lÃ§e</button>
      <button class="btn btn-sm" id="loc-btn" data-tip="Konumuma git [G]">ğŸ“ Konum</button>
      <button class="btn btn-sm" id="btn-export" onclick="openExport()" data-tip="Export & PaylaÅŸ">ğŸ“¤ Export</button>
    </div>
    <div class="header-row">
      <button class="btn btn-sm" id="btn-biz" onclick="openBiz()" data-tip="Gelir & iÅŸ modeli [P]">ğŸ’¼ Gelir</button>
      <button class="btn btn-sm" id="btn-lab" onclick="openLab()" data-tip="QA & iÃ§gÃ¶rÃ¼">ğŸ§ª Lab</button>
      <button class="btn btn-sm" id="btn-compass" onclick="openCompass()" data-tip="CanlÄ± pusula">ğŸ§­ Pusula</button>
      <button class="btn btn-sm" id="btn-follow" onclick="toggleFollowLock()" data-tip="Konum takip kilidi">ğŸ“ Takip</button>
      <button class="btn btn-sm" id="btn-nearby" onclick="loadNearbyCitySuggestions()" data-tip="YakÄ±nÄ±mdaki ÅŸehir Ã¶nerileri">ğŸ§­ YakÄ±n</button>
      <button class="btn btn-sm" id="btn-outdoor" onclick="toggleOutdoorMode()" data-tip="YÃ¼ksek kontrast dÄ±ÅŸ mekan">â˜€ï¸ Outdoor</button>
      <div class="lang-switch">
        <button class="btn-sm active" id="lang-tr" onclick="setLang('tr')">TR</button>
        <button class="btn-sm" id="lang-en" onclick="setLang('en')">EN</button>
      </div>
      <button class="btn btn-sm" onclick="openShortcuts()" data-tip="Klavye kÄ±sayollarÄ± [?]" style="border-color:transparent;padding:6px 8px">âŒ¨ï¸</button>
    </div>
  </div>
  <button class="mob-menu-btn" id="mob-menu-show" onclick="openMobDrawer()">â˜°</button>
</header>
<div class="mob-bottom-bar" id="mob-bottom-bar">
  <input id="mob-quick-city" type="text" placeholder="Åehir ara..." autocomplete="off"/>
  <button class="primary" onclick="mobQuickSearch()">Ara</button>
  <button onclick="useMyLocation()">ğŸ“</button>
</div>

<!-- Mobile drawer -->
<div class="mob-drawer-backdrop" id="mob-backdrop" onclick="closeMobDrawer()"></div>
<div class="mob-drawer" id="mob-drawer">
  <div class="mob-drawer-title">KÄ±ble DedektÃ¶rÃ¼</div>
  <div class="mob-search-row">
    <input id="mob-city-input" type="text" placeholder="Åehir ara..."/>
    <button onclick="mobSearch()">Ara</button>
  </div>
  <div class="mob-drawer-section">
    <div class="mob-drawer-section-lbl">Harita</div>
    <button class="mob-drawer-btn active" id="mob-btn-dark"  onclick="switchLayer('dark');closeMobDrawer()">ğŸŒ‘ Koyu Harita</button>
    <button class="mob-drawer-btn"        id="mob-btn-sat"   onclick="switchLayer('satellite');closeMobDrawer()">ğŸ›° Uydu</button>
    <button class="mob-drawer-btn"        id="mob-btn-osm"   onclick="switchLayer('osm');closeMobDrawer()">ğŸ—º Standart</button>
  </div>
  <div class="mob-drawer-section">
    <div class="mob-drawer-section-lbl">AraÃ§lar</div>
    <button class="mob-drawer-btn" onclick="toggleHeatmap();closeMobDrawer()">ğŸŒ¡ IsÄ± HaritasÄ±</button>
    <button class="mob-drawer-btn" onclick="toggleScoreCard();closeMobDrawer()">ğŸ“Š Skor KartÄ±</button>
    <button class="mob-drawer-btn" onclick="openCompare();closeMobDrawer()">âš–ï¸ KarÅŸÄ±laÅŸtÄ±r</button>
    <button class="mob-drawer-btn" onclick="toggleHistoryMode();closeMobDrawer()">ğŸ“… Tarihsel Analiz</button>
    <button class="mob-drawer-btn" onclick="openLeaderboard();closeMobDrawer()">ğŸŒ KÃ¼resel SÄ±ralama</button>
    <button class="mob-drawer-btn" onclick="useMyLocation();closeMobDrawer()">ğŸ“ Konumum</button>
    <button class="mob-drawer-btn" onclick="openExport();closeMobDrawer()">ğŸ“¤ Export & PaylaÅŸ</button>
    <button class="mob-drawer-btn" onclick="openBiz();closeMobDrawer()">ğŸ’¼ Gelir & Paketler</button>
    <button class="mob-drawer-btn" onclick="openLab();closeMobDrawer()">ğŸ§ª QA & Lab</button>
    <button class="mob-drawer-btn" onclick="openCompass();closeMobDrawer()">ğŸ§­ CanlÄ± Pusula</button>
    <button class="mob-drawer-btn" id="mob-btn-follow" onclick="toggleFollowLock();closeMobDrawer()">ğŸ“ Beni Takip Et</button>
    <button class="mob-drawer-btn" onclick="loadNearbyCitySuggestions();closeMobDrawer()">ğŸ§­ YakÄ±nÄ±mdaki Åehirler</button>
    <button class="mob-drawer-btn" id="mob-btn-outdoor" onclick="toggleOutdoorMode();closeMobDrawer()">â˜€ï¸ Outdoor Mod</button>
    <div class="mob-search-row">
      <button onclick="setLang('tr')">TR</button>
      <button onclick="setLang('en')">EN</button>
    </div>
  </div>
</div>

<!-- â•â• EXPORT MODAL â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="exp-overlay" id="exp-overlay" onclick="expOverlayClick(event)">
  <div class="exp-modal">

    <div class="exp-header">
      <div class="exp-title">ğŸ“¤ Export & PaylaÅŸÄ±m</div>
      <button class="exp-close" onclick="closeExport()">âœ•</button>
    </div>

    <!-- Share URL -->
    <div class="exp-section">
      <div class="exp-section-title">ğŸ”— PaylaÅŸÄ±labilir URL</div>
      <div class="exp-url-row">
        <input class="exp-url-input" id="exp-url-input" type="text" readonly/>
        <button class="exp-copy-btn" id="exp-copy-url" onclick="copyShareUrl()">Kopyala</button>
      </div>
      <div class="exp-url-hint">URL'de ÅŸehir adÄ±, harita merkezi ve zoom seviyesi kaydedilir. PaylaÅŸÄ±lan kiÅŸi aynÄ± gÃ¶rÃ¼nÃ¼me gider.</div>
    </div>

    <!-- Summary -->
    <div class="exp-section">
      <div class="exp-section-title">ğŸ“Š Mevcut Veri Ã–zeti</div>
      <div class="exp-summary" id="exp-summary"></div>
    </div>

    <!-- Download buttons -->
    <div class="exp-section">
      <div class="exp-section-title">ğŸ’¾ Ä°ndir</div>
      <div class="exp-dl-grid">
        <button class="exp-dl-btn" onclick="exportJSON()">
          <span class="exp-dl-icon">{ }</span>
          <span class="exp-dl-label">JSON</span>
          <span class="exp-dl-desc">TÃ¼m cami verisi</span>
        </button>
        <button class="exp-dl-btn" onclick="exportCSV()">
          <span class="exp-dl-icon">âŠ</span>
          <span class="exp-dl-label">CSV</span>
          <span class="exp-dl-desc">Excel uyumlu</span>
        </button>
        <button class="exp-dl-btn" onclick="exportGeoJSON()">
          <span class="exp-dl-icon">ğŸ—º</span>
          <span class="exp-dl-label">GeoJSON</span>
          <span class="exp-dl-desc">QGIS / Mapbox</span>
        </button>
        <button class="exp-dl-btn" onclick="exportReport()">
          <span class="exp-dl-icon">ğŸ“‹</span>
          <span class="exp-dl-label">HTML Rapor</span>
          <span class="exp-dl-desc">Yeni sekmede aÃ§</span>
        </button>
        <button class="exp-dl-btn" onclick="shareScoreCard()">
          <span class="exp-dl-icon">ğŸ–¼</span>
          <span class="exp-dl-label">Skor KartÄ±</span>
          <span class="exp-dl-desc">GÃ¶rsel Ã¼ret & paylaÅŸ</span>
        </button>
      </div>
    </div>

    <div class="exp-footer">
      Veri kaynaÄŸÄ±: OpenStreetMap katkÄ±cÄ±larÄ± Â· ODbL lisansÄ±
    </div>
  </div>
</div>

<!-- â•â• BUSINESS / MONETIZATION MODAL â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="biz-overlay" id="biz-overlay" onclick="bizOverlayClick(event)">
  <div class="biz-modal">
    <div class="biz-header">
      <div class="biz-title">ğŸ’¼ Gelir KanallarÄ± (Ãœyeliksiz)</div>
      <button class="biz-close" onclick="closeBiz()">âœ•</button>
    </div>

    <div class="biz-section">
      <div class="biz-section-title">Sponsor AlanlarÄ± (AylÄ±k)</div>
      <div class="biz-grid">
        <div class="biz-card">
          <div class="biz-card-name">Bronz Sponsor</div>
          <div class="biz-card-price">7.500 TL / ay</div>
          <div class="biz-card-desc">Footer + modal iÃ§inde gÃ¶rÃ¼nÃ¼rlÃ¼k</div>
        </div>
        <div class="biz-card">
          <div class="biz-card-name">GÃ¼mÃ¼ÅŸ Sponsor</div>
          <div class="biz-card-price">15.000 TL / ay</div>
          <div class="biz-card-desc">Sidebar + ÅŸehir raporu ekranÄ±nda gÃ¶rÃ¼nÃ¼rlÃ¼k</div>
        </div>
        <div class="biz-card">
          <div class="biz-card-name">AltÄ±n Sponsor</div>
          <div class="biz-card-price">30.000 TL / ay</div>
          <div class="biz-card-desc">Header rozeti + rapor sayfasÄ± sponsor etiketi</div>
        </div>
      </div>
      <div class="biz-cta-row">
        <a class="biz-cta" href="mailto:sales@qibla-checker.app?subject=Sponsorluk%20Teklifi">Sponsorluk Talebi</a>
      </div>
    </div>

    <div class="biz-section">
      <div class="biz-section-title">Tek Seferlik SatÄ±ÅŸ</div>
      <div class="biz-inline">
        <span>Kurumsal PDF Rapor</span>
        <strong>2.500 TL</strong>
      </div>
      <div class="biz-inline">
        <span>Toplu Åehir Analizi (10 ÅŸehir)</span>
        <strong>12.000 TL</strong>
      </div>
      <div class="biz-cta-row">
        <a class="biz-cta primary" href="https://example.com/odeme-linki" target="_blank" rel="noopener">Ã–deme Linki (Demo)</a>
        <button class="biz-cta" onclick="openExport();closeBiz()">Ã–nce Ã–rnek Rapor GÃ¶r</button>
      </div>
    </div>

    <div class="biz-section">
      <div class="biz-section-title">B2B / White-Label Talebi</div>
      <div class="biz-form">
        <input id="biz-name" type="text" placeholder="Ad Soyad"/>
        <input id="biz-company" type="text" placeholder="Kurum / Åirket"/>
        <input id="biz-email" type="email" placeholder="E-posta"/>
        <textarea id="biz-msg" placeholder="Ä°htiyaÃ§: white-label, API, toplu analiz..."></textarea>
        <button class="biz-cta primary" onclick="bizSendLead()">Teklif Maili OluÅŸtur</button>
      </div>
      <div class="biz-hint">Not: Bu sÃ¼rÃ¼m backend iÃ§ermez. Buton varsayÄ±lan e-posta uygulamasÄ± ile taslak aÃ§ar.</div>
    </div>
  </div>
</div>

<!-- â•â• QA / INSIGHTS LAB â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="lab-overlay" id="lab-overlay" onclick="labOverlayClick(event)">
  <div class="lab-modal">
    <div class="lab-header">
      <div class="lab-title">ğŸ§ª QA & Ä°Ã§gÃ¶rÃ¼ LaboratuvarÄ±</div>
      <button class="lab-close" onclick="closeLab()">âœ•</button>
    </div>
    <div class="lab-grid">
      <div class="lab-card">
        <div class="lab-card-title">Åehir Ä°Ã§gÃ¶rÃ¼sÃ¼</div>
        <div id="lab-insights"></div>
      </div>
      <div class="lab-card">
        <div class="lab-card-title">Kalite KuyruÄŸu</div>
        <div id="lab-queue"></div>
      </div>
      <div class="lab-card">
        <div class="lab-card-title">SÃ¼rÃ¼m GeÃ§miÅŸi</div>
        <div id="lab-snapshots"></div>
      </div>
    </div>
  </div>
</div>

<!-- â•â• LIVE COMPASS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="cmps-overlay" id="cmps-overlay" onclick="compassOverlayClick(event)">
  <div class="cmps-modal">
    <div class="cmps-header">
      <div class="cmps-title">ğŸ§­ CanlÄ± Pusula</div>
      <button class="cmps-close" onclick="closeCompass()">âœ•</button>
    </div>
    <div class="cmps-body">
      <canvas id="cmps-canvas" width="260" height="260"></canvas>
      <div class="cmps-rows" id="cmps-rows"></div>
      <div class="cmps-actions">
        <button class="btn btn-sm" onclick="requestCompassPermission()">SensÃ¶r Ä°zni</button>
        <button class="btn btn-sm" onclick="refreshCompassLocation()">Konumu Yenile</button>
        <button class="btn btn-sm" id="btn-map-sync" onclick="toggleMapCompassSync()">HaritayÄ± DÃ¶ndÃ¼r</button>
      </div>
    </div>
  </div>
</div>

<!-- â•â• 3D ANALYSIS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="m3d-overlay" id="m3d-overlay" onclick="m3dOverlayClick(event)">
  <div class="m3d-modal">
    <div class="m3d-header">
      <div class="m3d-title">ğŸ— 3D YÃ¶n Analizi (Deneysel)</div>
      <button class="m3d-close" onclick="close3D()">âœ•</button>
    </div>
    <div class="m3d-wrap">
      <canvas id="m3d-canvas"></canvas>
      <div class="m3d-side" id="m3d-side"></div>
    </div>
  </div>
</div>

<!-- â•â• KEYBOARD SHORTCUTS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="ks-overlay" id="ks-overlay" onclick="ksOverlayClick(event)">
  <div class="ks-modal">
    <div class="ks-title">
      âŒ¨ï¸ Klavye KÄ±sayollarÄ±
      <button class="ks-close-btn" onclick="closeShortcuts()">âœ•</button>
    </div>
    <div class="ks-grid">
      <div class="ks-row"><span class="ks-key">/</span><span class="ks-desc">Åehir arama</span></div>
      <div class="ks-row"><span class="ks-key">Enter</span><span class="ks-desc">Ara / Onayla</span></div>
      <div class="ks-row"><span class="ks-key">Esc</span><span class="ks-desc">Panel / Modal kapat</span></div>
      <div class="ks-row"><span class="ks-key">?</span><span class="ks-desc">Bu yardÄ±m ekranÄ±</span></div>
      <div class="ks-row"><span class="ks-key">H</span><span class="ks-desc">IsÄ± haritasÄ±</span></div>
      <div class="ks-row"><span class="ks-key">S</span><span class="ks-desc">Skor kartÄ±</span></div>
      <div class="ks-row"><span class="ks-key">T</span><span class="ks-desc">Tarihsel analiz</span></div>
      <div class="ks-row"><span class="ks-key">L</span><span class="ks-desc">SÄ±ralama tablosu</span></div>
      <div class="ks-row"><span class="ks-key">Q</span><span class="ks-desc">QA & lab paneli</span></div>
      <div class="ks-row"><span class="ks-key">O</span><span class="ks-desc">CanlÄ± pusula</span></div>
      <div class="ks-row"><span class="ks-key">P</span><span class="ks-desc">Gelir / paket modalÄ±</span></div>
      <div class="ks-row"><span class="ks-key">G</span><span class="ks-desc">Konumuma git</span></div>
      <div class="ks-row"><span class="ks-key">â†</span><span class="ks-desc">Ã–nceki cami</span></div>
      <div class="ks-row"><span class="ks-key">â†’</span><span class="ks-desc">Sonraki cami</span></div>
      <div class="ks-row"><span class="ks-key">+/-</span><span class="ks-desc">Tolerans artÄ±r/azalt</span></div>
      <div class="ks-row"><span class="ks-key">D</span><span class="ks-desc">Detay paneli kapat</span></div>
    </div>
    <div class="ks-footer">TÃ¼m kÄ±sayollar â€” metin giriÅŸi aktifken devre dÄ±ÅŸÄ±</div>
  </div>
</div>

<div class="stats-bar">
  <div class="stat"><div class="dot gold"></div><div class="stat-num" id="s-total">â€”</div><div class="stat-lbl">Cami</div></div>
  <div class="stat"><div class="dot green"></div><div class="stat-num" id="s-ok">â€”</div><div class="stat-lbl">DoÄŸru</div></div>
  <div class="stat"><div class="dot red"></div><div class="stat-num" id="s-bad">â€”</div><div class="stat-lbl">Sapma</div></div>
  <div class="stat"><div class="dot amber"></div><div class="stat-num" id="s-unk">â€”</div><div class="stat-lbl">Veri Yok</div></div>
  <div class="vp-status">
    <div class="vp-dot" id="vp-dot"></div>
    <span id="vp-label">HazÄ±r</span>
  </div>
  <div class="map-switch" id="axis-switch">
    <button id="axis-final" class="active" onclick="setAxisMode('final')">Final</button>
    <button id="axis-raw" onclick="setAxisMode('raw')">Raw</button>
    <button id="axis-interior" onclick="setAxisMode('interior')">Inside</button>
  </div>
  <div class="cache-info">Cache: <span id="cache-count">0</span> tile</div>
  <div class="district-pill" id="district-pill">
    <span id="district-pill-text">â€”</span>
    <button id="district-pill-clear" title="Ä°lÃ§e filtresini temizle">âœ•</button>
  </div>
  <div class="tol">Tolerans:<input type="range" id="tol" min="5" max="45" value="15"><span id="tol-val">15Â°</span></div>
</div>

<div class="main">
  <div id="map">
    <div class="mob-layer-stack" id="mob-layer-stack">
      <button class="mob-layer-btn active" id="mob-fab-dark" onclick="switchLayer('dark')" aria-label="Koyu harita">ğŸŒ‘ Koyu</button>
      <button class="mob-layer-btn" id="mob-fab-sat" onclick="switchLayer('satellite')" aria-label="Uydu harita">ğŸ›° Uydu</button>
      <button class="mob-layer-btn" id="mob-fab-osm" onclick="switchLayer('osm')" aria-label="Standart harita">ğŸ—º Harita</button>
    </div>
    <button class="compass-fab" id="compass-fab" onclick="toggleLiveMapCompass()" aria-label="CanlÄ± pusula modu">ğŸ§­</button>
    <!-- Mini non-blocking loader -->
    <div class="mini-loader" id="mini-loader">
      <div class="mini-spin"></div>
      <span id="mini-text">YÃ¼kleniyor...</span>
    </div>
    <!-- KÄ±ble animation info panel -->
    <div class="qibla-panel" id="qibla-panel">
      <div class="qp-name" id="qp-name">â€”</div>
      <div class="qp-row"><span class="qp-k" style="color:#c9a84c">â”€â”€</span><span class="qp-v" id="qp-angle" style="font-size:10px">â€”</span></div>
      <div class="qp-row"><span class="qp-k" style="color:#7c6ad8">â”€â”€</span><span class="qp-v" id="qp-diff" style="font-size:10px">â€”</span></div>
      <div class="qp-row"><span class="qp-k">Kabe</span><span class="qp-v" id="qp-dist">â€”</span></div>
      <div class="qp-anim" id="qp-anim-status">â— KÄ±ble Ã§izgisi Ã§iziliyor...</div>
    </div>
    <div class="district-hover-chip" id="district-hover-chip">Ä°lÃ§e modu: harita Ã¼zerinde gezdirin</div>

    <!-- Score Card Panel -->
    <div class="score-card" id="score-card">
      <div class="sc-close" onclick="toggleScoreCard()">âœ•</div>
      <div class="sc-city" id="sc-city">â€”</div>
      <div class="sc-score-wrap">
        <canvas id="sc-donut" width="110" height="110"></canvas>
        <div class="sc-score-center">
          <div class="sc-pct" id="sc-pct">â€”</div>
          <div class="sc-pct-lbl">doÄŸruluk</div>
        </div>
      </div>
      <div class="sc-grade" id="sc-grade"></div>
      <div class="sc-stats">
        <div class="sc-stat-row">
          <span class="sc-dot" style="background:#4ade80"></span>
          <span class="sc-stat-lbl">DoÄŸru yÃ¶n</span>
          <span class="sc-stat-val" id="sc-ok">â€”</span>
        </div>
        <div class="sc-stat-row">
          <span class="sc-dot" style="background:#f87171"></span>
          <span class="sc-stat-lbl">Sapma var</span>
          <span class="sc-stat-val" id="sc-bad">â€”</span>
        </div>
        <div class="sc-stat-row">
          <span class="sc-dot" style="background:#fbbf24"></span>
          <span class="sc-stat-lbl">Veri yok</span>
          <span class="sc-stat-val" id="sc-unk">â€”</span>
        </div>
        <div class="sc-stat-row" style="border-top:1px solid var(--border);margin-top:6px;padding-top:6px;">
          <span class="sc-stat-lbl" style="color:var(--muted)">Ort. sapma</span>
          <span class="sc-stat-val" id="sc-avg">â€”</span>
        </div>
        <div class="sc-stat-row">
          <span class="sc-stat-lbl" style="color:var(--muted)">Maks. sapma</span>
          <span class="sc-stat-val" id="sc-max">â€”</span>
        </div>
        <div class="sc-stat-row">
          <span class="sc-stat-lbl" style="color:var(--muted)">Min. sapma</span>
          <span class="sc-stat-val" id="sc-min">â€”</span>
        </div>
      </div>
      <div class="sc-best-worst">
        <div class="sc-bw-label">En Ä°yi â†‘</div>
        <div class="sc-bw-name" id="sc-best">â€”</div>
        <div class="sc-bw-label" style="margin-top:6px">En KÃ¶tÃ¼ â†“</div>
        <div class="sc-bw-name" id="sc-worst" style="color:var(--red)">â€”</div>
      </div>
      <div class="sc-tolerance">Tolerans: <span id="sc-tol-val">15Â°</span> ile hesaplandÄ±</div>
    </div>
  </div>
  <div class="sidebar">
    <div class="sb-head" id="sb-head-handle">
      <span>Cami Listesi</span>
      <span class="sb-count" id="sb-count"></span>
    </div>
    <div class="sb-snap-panels">
      <div class="sb-mini-panel" id="sb-mini-panel">
        <div class="sb-mini-title">Genel Skor</div>
        <div class="sb-mini-city" id="sb-mini-city">â€”</div>
        <div class="sb-mini-score" id="sb-mini-score">â€”</div>
        <div class="sb-mini-sub" id="sb-mini-sub">Veri bekleniyor</div>
      </div>
      <div class="sb-half-panel" id="sb-half-panel">
        <div class="sb-mini-title">Ä°statistik & Radar</div>
        <div class="sb-half-grid">
          <div class="sb-half-metrics">
            <div class="sb-half-row"><span>Toplam</span><b id="sb-m-total">â€”</b></div>
            <div class="sb-half-row"><span>DoÄŸruluk</span><b id="sb-m-pct">â€”</b></div>
            <div class="sb-half-row"><span>Ort. Sapma</span><b id="sb-m-avg">â€”</b></div>
            <div class="sb-half-row"><span>Maks Sapma</span><b id="sb-m-max">â€”</b></div>
          </div>
          <canvas id="sb-radar" width="108" height="108"></canvas>
        </div>
      </div>
    </div>
    <div class="ms-wrap" id="ms-wrap">
      <div class="ms-box">
        <span class="ms-icon">ğŸ”</span>
        <input id="mosque-search" type="text" placeholder="Cami adÄ± ara..." autocomplete="off" spellcheck="false"/>
        <button id="ms-clear" onclick="clearMosqueSearch()">âœ•</button>
      </div>
      <div class="ms-scope">
        <span class="ms-scope-lbl"><b>Bu alanda ara</b> (harita gÃ¶rÃ¼nÃ¼mÃ¼)</span>
        <label class="ms-switch" for="ms-scope-only">
          <input id="ms-scope-only" type="checkbox" checked/>
          <span class="ms-switch-track"></span>
        </label>
      </div>
      <div class="ms-dropdown" id="ms-dropdown"></div>
    </div>
    <div class="ms-filter-banner" id="ms-banner">
      <span id="ms-banner-text"></span>
      <button onclick="clearMosqueSearch()">âœ• Filtreyi KaldÄ±r</button>
    </div>
    <div class="pull-refresh" id="sb-pull-indicator">BÄ±rakÄ±nca yenilenecek</div>
    <div class="mosque-list" id="mosque-list">
      <div class="empty"><div class="empty-icon">ğŸ•Œ</div><div>Bir ÅŸehir arayÄ±n</div></div>
    </div>
    <div class="legend">
      <div style="font-size:9px;letter-spacing:.1em;text-transform:uppercase;margin-bottom:3px;">AÃ§Ä±klama</div>
      <div class="leg-row"><div class="leg-line" style="background:#4ade80"></div><span>KÄ±ble yÃ¶nÃ¼nde</span></div>
      <div class="leg-row"><div class="leg-line" style="background:#f87171"></div><span>Sapma var</span></div>
      <div class="leg-row"><div class="leg-line" style="background:transparent;border-top:1px dashed #c9a84c;height:0;width:22px"></div><span>GerÃ§ek kÄ±ble yÃ¶nÃ¼</span></div>
      <div class="leg-row"><div class="leg-line" style="background:rgba(201,168,76,.6)"></div><span>Bina kÄ±ble duvarÄ±</span></div>
      <div class="leg-row"><div class="leg-line" style="background:#7c6ad8"></div><span>BinanÄ±n gerÃ§ek baktÄ±ÄŸÄ± yÃ¶n</span></div>
      <div class="leg-row"><div class="leg-line" style="background:transparent;border-top:2px dashed #c9a84c;height:0;width:22px"></div><span>Kabe'ye bÃ¼yÃ¼k daire (doÄŸru)</span></div>
    </div>
  </div>
</div>

<div class="overlay" id="overlay">
  <div class="spinner"></div>
  <div class="ov-text" id="ov-text">YÃ¼kleniyor...</div>
  <div class="ov-sub" id="ov-sub"></div>
</div>
<div class="toast" id="toast"></div>
<script src="./vendor/leaflet/leaflet.js"></script>



<!-- â•â• DETAIL PANEL â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="dp-backdrop" id="dp-backdrop" onclick="closeDetailPanel()"></div>
<div class="dp-panel" id="dp-panel">

  <!-- Header -->
  <div class="dp-head">
    <div class="dp-head-left">
      <div class="dp-name" id="dp-name">â€”</div>
      <div class="dp-name-ar" id="dp-name-ar"></div>
      <div class="dp-place" id="dp-place"></div>
      <div class="dp-coords" id="dp-coords"></div>
    </div>
    <button class="dp-close" onclick="closeDetailPanel()">âœ•</button>
  </div>

  <!-- Status ribbon -->
  <div class="dp-ribbon" id="dp-ribbon">
    <div class="dp-ribbon-item" id="dp-status-badge"></div>
    <div class="dp-ribbon-item">
      <span class="dp-ribbon-lbl">KÄ±ble</span>
      <span class="dp-ribbon-val" id="dp-qibla-val">â€”</span>
    </div>
    <div class="dp-ribbon-item">
      <span class="dp-ribbon-lbl">Bina YÃ¶nÃ¼</span>
      <span class="dp-ribbon-val" id="dp-axis-val">â€”</span>
    </div>
    <div class="dp-ribbon-item">
      <span class="dp-ribbon-lbl">Sapma</span>
      <span class="dp-ribbon-val" id="dp-diff-val">â€”</span>
    </div>
    <div class="dp-ribbon-item">
      <span class="dp-ribbon-lbl">Kabe</span>
      <span class="dp-ribbon-val" id="dp-dist-val">â€”</span>
    </div>
  </div>

  <!-- Photo -->
  <div class="dp-photo-wrap" id="dp-photo-wrap" style="display:none">
    <img class="dp-photo" id="dp-photo" alt="Cami fotoÄŸrafÄ±"/>
    <div class="dp-photo-credit" id="dp-photo-credit"></div>
  </div>

  <!-- Interior evidence -->
  <div class="dp-section" id="dp-interior-section">
    <div class="dp-section-title">Ä°Ã§ Mekan KanÄ±tÄ±</div>
    <div class="dp-int-gallery" id="dp-int-gallery"></div>
    <div class="dp-int-meta" id="dp-int-meta"></div>
    <div class="dp-int-form">
      <label for="dp-int-axis">Namaz saf/mihrab yÃ¶nÃ¼ (0â€“179Â°)</label>
      <input id="dp-int-axis" type="range" min="0" max="179" value="90" oninput="document.getElementById('dp-int-axis-val').textContent=this.value+'Â°'"/>
      <div class="dp-int-axis-val" id="dp-int-axis-val">90Â°</div>
      <select id="dp-int-conf">
        <option value="0.55">DÃ¼ÅŸÃ¼k gÃ¼ven</option>
        <option value="0.75" selected>Orta gÃ¼ven</option>
        <option value="0.9">YÃ¼ksek gÃ¼ven</option>
      </select>
      <input id="dp-int-url" type="text" placeholder="Kaynak URL (opsiyonel)"/>
      <input id="dp-int-note" type="text" placeholder="Not (Ã¶rn: mihrab aÃ§Ä±kÃ§a gÃ¶rÃ¼nÃ¼yor)"/>
      <button class="dp-action-btn" onclick="saveInteriorEvidence()">Ä°Ã§ Mekan YÃ¶nÃ¼nÃ¼ Kaydet</button>
    </div>
    <div class="dp-int-form">
      <label>Manuel Aks DÃ¼zeltme (Harita Ãœzerinde 2 Nokta)</label>
      <button class="dp-action-btn" id="dp-manual-start" onclick="startManualAxisCapture()">Haritada Aks Ã‡iz</button>
      <button class="dp-action-btn" onclick="cancelManualAxisCapture()">Ä°ptal</button>
      <div class="dp-int-meta" id="dp-manual-status">HazÄ±r</div>
    </div>
    <div class="dp-int-ev-list" id="dp-int-ev-list"></div>
  </div>

  <!-- Qibla mini diagram -->
  <div class="dp-section">
    <div class="dp-section-title">KÄ±ble Analizi</div>
    <div class="dp-qibla-row">
      <canvas id="dp-compass" width="120" height="120"></canvas>
      <div class="dp-qibla-stats" id="dp-qibla-stats"></div>
    </div>
  </div>

  <div class="dp-section">
    <div class="dp-section-title">AÃ§Ä±klanabilirlik</div>
    <div class="dp-tags" id="dp-explain"></div>
  </div>

  <!-- Wikipedia summary -->
  <div class="dp-section" id="dp-wiki-section" style="display:none">
    <div class="dp-section-title">Wikipedia</div>
    <div class="dp-wiki-body" id="dp-wiki-body"></div>
    <a class="dp-wiki-link" id="dp-wiki-link" target="_blank" rel="noopener">Wikipedia'da oku â†’</a>
  </div>

  <!-- OSM Tags -->
  <div class="dp-section">
    <div class="dp-section-title" id="dp-tags-title">OSM Etiketleri</div>
    <div class="dp-tags" id="dp-tags"></div>
  </div>

  <!-- Action buttons -->
  <div class="dp-actions" id="dp-actions"></div>

</div>

<!-- â•â• LEADERBOARD MODAL â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="lb-overlay" id="lb-overlay" onclick="lbOverlayClick(event)">
  <div class="lb-modal" id="lb-modal">

    <div class="lb-header">
      <div class="lb-title">ğŸŒ KÃ¼resel KÄ±ble SÄ±ralamasÄ±</div>
      <div class="lb-header-right">
        <span class="lb-updated" id="lb-updated"></span>
        <button class="lb-close" onclick="closeLeaderboard()">âœ•</button>
      </div>
    </div>

    <!-- Controls bar -->
    <div class="lb-controls">
      <div class="lb-add-wrap">
        <input id="lb-city-input" type="text" placeholder="Åehir ekle... (Ã¶rn: Konya, Cairo, Lahore)" autocomplete="off"/>
        <button id="lb-add-btn" onclick="lbAddCity()">+ Analiz Et</button>
      </div>
      <div class="lb-mode-row">
        <span class="lb-sort-label">Mod:</span>
        <button class="lb-mode active" data-mode="qibla" onclick="lbSetDataset('qibla')">ğŸ§­ Åehir Analizi</button>
        <button class="lb-mode" data-mode="admin" onclick="lbSetDataset('admin')">ğŸ“Š Ä°l/State SayÄ±mÄ±</button>
      </div>
      <div class="lb-progress-wrap" id="lb-progress-wrap" style="display:none">
        <div class="lb-progress-bar" id="lb-progress-bar"></div>
        <span class="lb-progress-label" id="lb-progress-label">Analiz ediliyor...</span>
      </div>
      <div class="lb-filters">
        <button class="lb-filter active" data-region="all"   onclick="lbSetRegion('all')">ğŸŒ TÃ¼mÃ¼</button>
        <button class="lb-filter"        data-region="turkey" onclick="lbSetRegion('turkey')">ğŸ‡¹ğŸ‡· TÃ¼rkiye</button>
        <button class="lb-filter"        data-region="mideast" onclick="lbSetRegion('mideast')">ğŸŒ™ Orta DoÄŸu</button>
        <button class="lb-filter"        data-region="asia"    onclick="lbSetRegion('asia')">ğŸŒ GÃ¼ney Asya</button>
        <button class="lb-filter"        data-region="africa"  onclick="lbSetRegion('africa')">ğŸŒ Afrika</button>
        <button class="lb-filter"        data-region="europe"  onclick="lbSetRegion('europe')">ğŸ‡ªğŸ‡º Avrupa</button>
        <button class="lb-filter"        data-region="other"   onclick="lbSetRegion('other')">ğŸ—º DiÄŸer</button>
      </div>
      <div class="lb-sort-row">
        <span class="lb-sort-label">SÄ±rala:</span>
        <button class="lb-sort active" data-sort="pct"   onclick="lbSetSort('pct')">DoÄŸruluk %</button>
        <button class="lb-sort"        data-sort="count" onclick="lbSetSort('count')">Cami SayÄ±sÄ±</button>
        <button class="lb-sort"        data-sort="avg"   onclick="lbSetSort('avg')">Ort. Sapma</button>
        <button class="lb-sort"        data-sort="name"  onclick="lbSetSort('name')">Åehir AdÄ±</button>
      </div>
    </div>

    <!-- Summary strip -->
    <div class="lb-summary" id="lb-summary"></div>

    <!-- Table -->
    <div class="lb-table-wrap">
      <div class="lb-table-head">
        <span class="lbt-rank">#</span>
        <span class="lbt-city" id="lb-h-city">Åehir</span>
        <span class="lbt-bar" id="lb-h-bar">DoÄŸruluk</span>
        <span class="lbt-pct" id="lb-h-pct">%</span>
        <span class="lbt-not" id="lb-h-note">Not</span>
        <span class="lbt-count" id="lb-h-count">Cami</span>
        <span class="lbt-avg" id="lb-h-avg">Ort.Sap.</span>
        <span class="lbt-date">Analiz</span>
        <span class="lbt-act"></span>
      </div>
      <div id="lb-rows"></div>
    </div>

    <div class="lb-footer">
      Veriler <strong>OpenStreetMap</strong> Â· Åehir merkezi 8km yarÄ±Ã§apÄ± Â· localStorage'da saklanÄ±r
      <button class="lb-clear-btn" onclick="lbClearAll()">ğŸ—‘ TÃ¼mÃ¼nÃ¼ Temizle</button>
    </div>
  </div>
</div>

<!-- â•â• HISTORY MODAL â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="hist-overlay" id="hist-overlay" onclick="histOverlayClick(event)">
  <div class="hist-modal" id="hist-modal">
    <div class="hist-header">
      <div class="hist-title">ğŸ“… Tarihsel DÃ¶nem Analizi</div>
      <button class="hist-close" onclick="closeHistoryMode()">âœ•</button>
    </div>

    <!-- Period filter chips -->
    <div class="hist-chips" id="hist-chips">
      <button class="hist-chip all active" onclick="filterPeriod('all')" data-period="all">TÃ¼mÃ¼</button>
      <button class="hist-chip ottoman" onclick="filterPeriod('ottoman')" data-period="ottoman">ğŸ•Œ OsmanlÄ± <span class="hist-chip-sub">â€”1922</span></button>
      <button class="hist-chip early" onclick="filterPeriod('early')" data-period="early">ğŸ‡¹ğŸ‡· Erken Cum. <span class="hist-chip-sub">1923â€“50</span></button>
      <button class="hist-chip mid" onclick="filterPeriod('mid')" data-period="mid">ğŸ— Orta <span class="hist-chip-sub">1951â€“2000</span></button>
      <button class="hist-chip modern" onclick="filterPeriod('modern')" data-period="modern">ğŸ™ Modern <span class="hist-chip-sub">2001+</span></button>
      <button class="hist-chip unknown" onclick="filterPeriod('unknown')" data-period="unknown">â“ Tarihi Bilinmiyor</button>
    </div>

    <!-- Summary cards row -->
    <div class="hist-cards" id="hist-cards"></div>

    <!-- Bar chart canvas -->
    <div class="hist-chart-wrap">
      <div class="hist-section-label">DÃ¶neme GÃ¶re DoÄŸruluk KarÅŸÄ±laÅŸtÄ±rmasÄ±</div>
      <canvas id="hist-chart" height="140"></canvas>
    </div>

    <!-- Scatter: inÅŸaat yÄ±lÄ± vs sapma -->
    <div class="hist-scatter-wrap">
      <div class="hist-section-label">Ä°nÅŸaat YÄ±lÄ± Ã— KÄ±ble SapmasÄ± <span style="color:#6b6b7a;font-size:9px">(veri olan camiler)</span></div>
      <canvas id="hist-scatter" height="160"></canvas>
      <div class="hist-scatter-legend">
        <span class="hsl-dot ottoman"></span>OsmanlÄ± &nbsp;
        <span class="hsl-dot early"></span>Erken Cum. &nbsp;
        <span class="hsl-dot mid"></span>Orta &nbsp;
        <span class="hsl-dot modern"></span>Modern
      </div>
    </div>

    <!-- Detail table -->
    <div class="hist-table-wrap">
      <div class="hist-section-label">DÃ¶nem Detay Tablosu</div>
      <div id="hist-table"></div>
    </div>

    <!-- Filtered list -->
    <div class="hist-list-wrap">
      <div class="hist-section-label" id="hist-list-label">SeÃ§ili dÃ¶nemdeki camiler</div>
      <div class="hist-list" id="hist-list"></div>
    </div>

    <div class="hist-footer">
      OSM <code>start_date</code> / <code>building:start_date</code> tag verisi Â· Tarihi olmayan camiler "bilinmiyor" kategorisinde
    </div>
  </div>
</div>

<!-- â•â• COMPARISON MODAL â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="cmp-overlay" id="cmp-overlay" onclick="cmpOverlayClick(event)">
  <div class="cmp-modal" id="cmp-modal">
    <div class="cmp-header">
      <div class="cmp-title">âš–ï¸ Åehir KarÅŸÄ±laÅŸtÄ±rmasÄ±</div>
      <button class="cmp-close" onclick="closeCompare()">âœ•</button>
    </div>
    <div class="cmp-inputs">
      <div class="cmp-city-col">
        <div class="cmp-city-label" style="color:#60a5fa">Åehir A</div>
        <div class="cmp-search-row">
          <input id="cmp-a-input" type="text" placeholder="Åehir/ilÃ§e adÄ± girin..." autocomplete="off"/>
          <select id="cmp-a-level">
            <option value="city">Åehir</option>
            <option value="district">Ä°lÃ§e</option>
          </select>
        </div>
        <div class="cmp-search-row">
          <button class="btn" id="cmp-a-fetch-btn" onclick="fetchCompareSide('a')">YÃ¼kle</button>
          <button class="btn btn-sm" id="cmp-a-clear-btn" onclick="clearCompareSide('a')">KaldÄ±r</button>
        </div>
        <div class="cmp-city-current" id="cmp-a-name">â€”</div>
        <div class="cmp-city-status" id="cmp-a-status"></div>
      </div>
      <div class="cmp-vs">VS</div>
      <div class="cmp-city-col">
        <div class="cmp-city-label" style="color:#f472b6">Åehir B</div>
        <div class="cmp-search-row">
          <input id="cmp-b-input" type="text" placeholder="Åehir/ilÃ§e adÄ± girin..." autocomplete="off"/>
          <select id="cmp-b-level">
            <option value="city">Åehir</option>
            <option value="district">Ä°lÃ§e</option>
          </select>
        </div>
        <div class="cmp-search-row">
          <button class="btn" id="cmp-b-fetch-btn" onclick="fetchCompareSide('b')">YÃ¼kle</button>
          <button class="btn btn-sm" id="cmp-b-clear-btn" onclick="clearCompareSide('b')">KaldÄ±r</button>
        </div>
        <div class="cmp-city-current" id="cmp-b-name">â€”</div>
        <div class="cmp-city-status" id="cmp-b-status"></div>
      </div>
    </div>
    <div class="cmp-progress-wrap" id="cmp-progress-wrap" style="display:none">
      <div class="cmp-progress-bar" id="cmp-progress-bar"></div>
      <div class="cmp-progress-label" id="cmp-progress-label">YÃ¼kleniyor...</div>
    </div>
    <div class="cmp-results" id="cmp-results" style="display:none">
      <div class="cmp-score-row">
        <div class="cmp-score-block cmp-a-bg">
          <div class="cmp-score-pct" id="cmp-a-pct">â€”</div>
          <canvas id="cmp-a-donut" width="80" height="80"></canvas>
          <div class="cmp-score-grade" id="cmp-a-grade"></div>
          <div class="cmp-score-city" id="cmp-a-label">â€”</div>
        </div>
        <div class="cmp-winner-col">
          <div class="cmp-winner-badge" id="cmp-winner-badge"></div>
          <canvas id="cmp-radar" width="200" height="200"></canvas>
          <div class="cmp-radar-legend">
            <span class="cmp-leg-a">â– </span> A &nbsp;
            <span class="cmp-leg-b">â– </span> B
          </div>
        </div>
        <div class="cmp-score-block cmp-b-bg">
          <div class="cmp-score-pct" id="cmp-b-pct">â€”</div>
          <canvas id="cmp-b-donut" width="80" height="80"></canvas>
          <div class="cmp-score-grade" id="cmp-b-grade"></div>
          <div class="cmp-score-city" id="cmp-b-label">â€”</div>
        </div>
      </div>
      <div class="cmp-bars-section">
        <div class="cmp-section-label">Metrik KarÅŸÄ±laÅŸtÄ±rmasÄ±</div>
        <div id="cmp-bars"></div>
      </div>
      <div class="cmp-table-section">
        <div class="cmp-section-label">Ã–zet Tablo</div>
        <div id="cmp-table"></div>
      </div>
    </div>
    <div class="cmp-footer">Tolerans: <span id="cmp-tol">15Â°</span> Â· OSM verisi</div>
  </div>
</div>













<script src="./assets/js/app.js"></script>
</body>
</html>
