<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, maximum-scale=1">
<meta http-equiv="Content-Security-Policy" content="default-src 'self' https: data: blob:; script-src 'self' 'unsafe-inline' https://unpkg.com https://cdn.jsdelivr.net https://cdnjs.cloudflare.com; style-src 'self' 'unsafe-inline' https://unpkg.com https://fonts.googleapis.com; img-src 'self' https: data: blob:; connect-src 'self' https://overpass-api.de https://overpass.kumi.systems https://lz4.overpass-api.de https://nominatim.openstreetmap.org https://commons.wikimedia.org https://*.wikipedia.org https://www.wikidata.org https://*.tile.openstreetmap.org https://*.basemaps.cartocdn.com https://server.arcgisonline.com; object-src 'none'; base-uri 'self'; frame-ancestors 'self';">
<title>Kıble Dedektörü</title>
<meta name="description" content="Kıble Dedektörü — bina yönü analizi ve cami kıble doğruluk haritası">
<link rel="canonical" href="https://www.qible.app/">
<link rel="icon" type="image/svg+xml" href="/assets/img/qible.svg">
<link rel="apple-touch-icon" href="/assets/img/qible.svg">
<link rel="image_src" href="https://www.qible.app/assets/img/qible.svg">
<meta property="og:type" content="website">
<meta property="og:site_name" content="Qible">
<meta property="og:title" content="Kıble Dedektörü">
<meta property="og:description" content="Bina yönü analizi ve cami kıble doğruluk haritası">
<meta property="og:image" content="https://www.qible.app/assets/img/qible.svg">
<meta property="og:image:url" content="https://www.qible.app/assets/img/qible.svg">
<meta property="og:image:secure_url" content="https://www.qible.app/assets/img/qible.svg">
<meta property="og:url" content="https://www.qible.app/">
<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="630">
<meta property="og:image:type" content="image/svg+xml">
<meta property="og:image:alt" content="Qible logo">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="Kıble Dedektörü">
<meta name="twitter:description" content="Bina yönü analizi ve cami kıble doğruluk haritası">
<meta name="twitter:image" content="https://www.qible.app/assets/img/qible.svg">
<meta name="twitter:image:src" content="https://www.qible.app/assets/img/qible.svg">

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<link rel="stylesheet" href="./vendor/leaflet/leaflet.css"/>
<link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css"/>
<link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css"/>
<link rel="stylesheet" href="./assets/css/app.css">
</head>
<body>

<header>
  <div class="brand-home" role="button" tabindex="0" onclick="resetToHome()" onkeydown="if(event.key==='Enter'||event.key===' '){event.preventDefault();resetToHome();}">
    <div class="logo-q"><img src="/assets/img/qible.svg" alt="Qible logo"></div>
    <div>
      <div class="logo-title">Kıble Dedöktörü</div>
      <div class="logo-sub">Bina yönü analizi</div>
    </div>
  </div>
  <div class="divider"></div>
  <div class="header-actions">
    <div class="header-row header-row-groups">
      <div class="nav-group">
        <div class="nav-group-title">Harita</div>
        <div class="map-switch">
          <button id="btn-dark" class="active" onclick="switchLayer('dark')" data-tip="Koyu harita"> Koyu</button>
          <button id="btn-sat" onclick="switchLayer('satellite')" data-tip="Uydu görünümü"> Uydu</button>
          <button id="btn-osm" onclick="switchLayer('osm')" data-tip="Standart harita"> Harita</button>
        </div>
        <button id="btn-district" class="btn btn-sm" data-tip="İlçe modu (hover + tıkla)"> İlçe</button>
      </div>

      <div class="nav-group">
        <div class="nav-group-title">Analiz</div>
        <button id="btn-heat" class="btn btn-sm" onclick="toggleHeatmap()" data-tip="Isı haritası [H]"> Isı</button>
        <button id="btn-score" class="btn btn-sm" onclick="toggleScoreCard()" data-tip="Skor kartı [S]"> Skor</button>
        <button id="btn-compare" class="btn btn-sm" onclick="openCompare()" data-tip="Şehir karşılaştır [C]"> Karşılaştır</button>
        <button id="btn-history" class="btn btn-sm" onclick="toggleHistoryMode()" data-tip="Tarihsel analiz [T]"> Tarih</button>
        <button id="btn-lb" class="btn btn-sm" onclick="openLeaderboard()" data-tip="Küresel sıralama [L]"> Sıralama</button>
      </div>

      <div class="nav-group">
        <div class="nav-group-title">Eylemler</div>
        <button class="btn btn-sm" id="loc-btn" data-tip="Konumuma git [G]"> Konum</button>
        <button class="btn btn-sm" id="btn-compass" onclick="openCompass()" data-tip="Canlı pusula"> Pusula</button>
        <button class="btn btn-sm" id="btn-follow" onclick="toggleFollowLock()" data-tip="Konum takip kilidi"> Takip</button>
        <button class="btn btn-sm" id="btn-nearby" onclick="loadNearbyCitySuggestions()" data-tip="Yakınımdaki şehir önerileri"> Yakın</button>
        <button class="btn btn-sm" id="btn-export" onclick="openExport()" data-tip="Export & Paylaş"> Export</button>
      </div>

      <div class="nav-group">
        <div class="nav-group-title">Sistem</div>
        <button class="btn btn-sm" id="btn-biz" onclick="openBiz()" data-tip="Gelir & iş modeli [P]"> Gelir</button>
        <button class="btn btn-sm" id="btn-lab" onclick="openLab()" data-tip="QA & içgörü"> Lab</button>
        <button class="btn btn-sm" id="btn-outdoor" onclick="toggleOutdoorMode()" data-tip="Yüksek kontrast dış mekan"> Outdoor</button>
        <div class="lang-switch">
          <button class="btn-sm active" id="lang-tr" onclick="setLang('tr')">TR</button>
          <button class="btn-sm" id="lang-en" onclick="setLang('en')">EN</button>
        </div>
        <button class="btn btn-sm" onclick="openShortcuts()" data-tip="Klavye kısayolları [?]" style="border-color:transparent;padding:6px 8px">⌨</button>
      </div>
    </div>
  </div>
  <button class="mob-menu-btn" id="mob-menu-show" onclick="openMobDrawer()"></button>
</header>
<!-- ═══ DESKTOP NAV SIDEBAR ═══ -->
<nav class="nav-sidebar" id="nav-sidebar">
  <div class="nav-sidebar-top">
    <!-- Logo -->
    <div class="ns-brand" role="button" tabindex="0" onclick="resetToHome()" title="Ana Sayfa">
      <div class="logo-q"><img src="/assets/img/qible.svg" alt="Qible logo"></div>
    </div>
    <div class="ns-brand-text" role="button" tabindex="0" onclick="resetToHome()" title="Ana Sayfa">
      <div class="ns-brand-title">Kıble Dedektörü</div>
      <div class="ns-brand-sub">Bina Yönü Analizi</div>
    </div>
    <div class="ns-divider"></div>

    <!-- Harita Grubu -->
    <div class="ns-group">
      <div class="ns-group-label">Harita</div>
      <button class="ns-btn active" id="ns-btn-dark" onclick="switchLayer('dark')" data-tip="Koyu Harita">
        <span class="ns-icon">◐</span>
        <span class="ns-label">Koyu</span>
      </button>
      <button class="ns-btn" id="ns-btn-sat" onclick="switchLayer('satellite')" data-tip="Uydu">
        <span class="ns-icon">◫</span>
        <span class="ns-label">Uydu</span>
      </button>
      <button class="ns-btn" id="ns-btn-osm" onclick="switchLayer('osm')" data-tip="Standart">
        <span class="ns-icon">▦</span>
        <span class="ns-label">Harita</span>
      </button>
    </div>

    <div class="ns-divider"></div>

    <!-- Analiz Grubu -->
    <div class="ns-group">
      <div class="ns-group-label">Analiz</div>
      <button class="ns-btn" id="ns-btn-heat" onclick="document.getElementById('btn-heat').click()" data-tip="Isı Haritası">
        <span class="ns-icon">◍</span>
        <span class="ns-label">Isı</span>
      </button>
      <button class="ns-btn" id="ns-btn-score" onclick="document.getElementById('btn-score').click()" data-tip="Skor Kartı">
        <span class="ns-icon">◌</span>
        <span class="ns-label">Skor</span>
      </button>
      <button class="ns-btn" id="ns-btn-compare" onclick="document.getElementById('btn-compare').click()" data-tip="Karşılaştır">
        <span class="ns-icon">⇄</span>
        <span class="ns-label">Karşılaştır</span>
      </button>
      <button class="ns-btn" id="ns-btn-history" onclick="document.getElementById('btn-history').click()" data-tip="Tarihsel Analiz">
        <span class="ns-icon">◷</span>
        <span class="ns-label">Tarih</span>
      </button>
      <button class="ns-btn" id="ns-btn-lb" onclick="document.getElementById('btn-lb').click()" data-tip="Küresel Sıralama">
        <span class="ns-icon">☰</span>
        <span class="ns-label">Sıralama</span>
      </button>
      <button class="ns-btn" id="ns-btn-district" onclick="document.getElementById('btn-district').click()" data-tip="İlçe Modu">
        <span class="ns-icon">⊞</span>
        <span class="ns-label">İlçe</span>
      </button>
    </div>

    <div class="ns-divider"></div>

    <!-- Araçlar Grubu -->
    <div class="ns-group">
      <div class="ns-group-label">Araçlar</div>
      <button class="ns-btn" id="ns-btn-loc" onclick="document.getElementById('loc-btn').click()" data-tip="Konumum">
        <span class="ns-icon">⌖</span>
        <span class="ns-label">Konum</span>
      </button>
      <button class="ns-btn" id="ns-btn-compass" onclick="document.getElementById('btn-compass').click()" data-tip="Canlı Pusula">
        <span class="ns-icon">◎</span>
        <span class="ns-label">Pusula</span>
      </button>
      <button class="ns-btn" id="ns-btn-follow" onclick="document.getElementById('btn-follow').click()" data-tip="Takip Et">
        <span class="ns-icon">⟳</span>
        <span class="ns-label">Takip</span>
      </button>
      <button class="ns-btn" id="ns-btn-nearby" onclick="document.getElementById('btn-nearby').click()" data-tip="Yakındaki Şehirler">
        <span class="ns-icon">◉</span>
        <span class="ns-label">Yakın</span>
      </button>
      <button class="ns-btn" id="ns-btn-export" onclick="document.getElementById('btn-export').click()" data-tip="Export & Paylaş">
        <span class="ns-icon">↗</span>
        <span class="ns-label">Export</span>
      </button>
    </div>
  </div>

  <!-- Alt Kısım -->
  <div class="nav-sidebar-bottom">
    <div class="ns-divider"></div>
    <button class="ns-btn" id="ns-btn-lab" onclick="document.getElementById('btn-lab').click()" data-tip="QA Lab">
      <span class="ns-icon">◧</span>
      <span class="ns-label">Lab</span>
    </button>
    <button class="ns-btn" id="ns-btn-outdoor" onclick="document.getElementById('btn-outdoor').click()" data-tip="Outdoor Mod">
      <span class="ns-icon">☼</span>
      <span class="ns-label">Outdoor</span>
    </button>
    <div class="ns-lang">
      <button class="ns-lang-btn active" id="ns-lang-tr" onclick="document.getElementById('lang-tr').click()">TR</button>
      <button class="ns-lang-btn" id="ns-lang-en" onclick="document.getElementById('lang-en').click()">EN</button>
    </div>

    <!-- Sidebar Toggle -->
    <button class="ns-toggle" id="ns-toggle" onclick="toggleNavSidebar()" data-tip="Menüyü Daralt">
      <span class="ns-icon">«</span>
    </button>
  </div>
</nav>
<div class="mob-bottom-bar" id="mob-bottom-bar">
  <input id="mob-quick-city" type="text" placeholder="Şehir ara..." autocomplete="off"/>
  <button class="primary" onclick="mobQuickSearch()">Ara</button>
  <button onclick="useMyLocation()"></button>
  <div class="city-smart-dd" id="mob-city-smart-dd"></div>
</div>

<!-- Mobile drawer -->
<div class="mob-drawer-backdrop" id="mob-backdrop" onclick="closeMobDrawer()"></div>
<div class="mob-drawer" id="mob-drawer">
  <div class="mob-drawer-shell">
    <div class="mob-drawer-head">
      <div class="mob-brand-chip">
        <span class="mob-brand-icon"><img src="/assets/img/qible.svg" alt="Qible logo"></span>
        <span>Kıble Dedektörü</span>
      </div>
      <button class="mob-drawer-close" onclick="closeMobDrawer()">×</button>
    </div>

    <div class="mob-search-row">
      <span class="mob-search-icon">⌕</span>
      <input id="mob-city-input" type="text" placeholder="Şehir veya cami ara"/>
      <button onclick="mobSearch()">Ara</button>
      <div class="city-smart-dd" id="mob-drawer-city-smart-dd"></div>
    </div>

    <div class="mob-drawer-scroll">
      <div class="mob-drawer-section">
        <div class="mob-drawer-section-lbl">Harita</div>
        <button class="mob-drawer-btn active" id="mob-btn-dark" onclick="switchLayer('dark');closeMobDrawer()"><span class="mob-nav-ico">◐</span><span>Koyu Harita</span></button>
        <button class="mob-drawer-btn" id="mob-btn-sat" onclick="switchLayer('satellite');closeMobDrawer()"><span class="mob-nav-ico">◫</span><span>Uydu</span></button>
        <button class="mob-drawer-btn" id="mob-btn-osm" onclick="switchLayer('osm');closeMobDrawer()"><span class="mob-nav-ico">▦</span><span>Standart</span></button>
      </div>

      <div class="mob-drawer-section">
        <div class="mob-drawer-section-lbl">Analiz</div>
        <button class="mob-drawer-btn" onclick="toggleHeatmap();closeMobDrawer()"><span class="mob-nav-ico">◍</span><span>Isı Haritası</span></button>
        <button class="mob-drawer-btn" onclick="toggleScoreCard();closeMobDrawer()"><span class="mob-nav-ico">◌</span><span>Skor Kartı</span></button>
        <button class="mob-drawer-btn" onclick="openCompare();closeMobDrawer()"><span class="mob-nav-ico">⇄</span><span>Karşılaştır</span></button>
        <button class="mob-drawer-btn" onclick="toggleHistoryMode();closeMobDrawer()"><span class="mob-nav-ico">◷</span><span>Tarihsel Analiz</span></button>
        <button class="mob-drawer-btn" onclick="openLeaderboard();closeMobDrawer()"><span class="mob-nav-ico">☰</span><span>Küresel Sıralama</span></button>
      </div>

      <div class="mob-drawer-section">
        <div class="mob-drawer-section-lbl">Eylemler</div>
        <button class="mob-drawer-btn" onclick="useMyLocation();closeMobDrawer()"><span class="mob-nav-ico">⌖</span><span>Konumum</span></button>
        <button class="mob-drawer-btn" id="mob-btn-follow" onclick="toggleFollowLock();closeMobDrawer()"><span class="mob-nav-ico">⟳</span><span>Beni Takip Et</span></button>
        <button class="mob-drawer-btn" onclick="loadNearbyCitySuggestions();closeMobDrawer()"><span class="mob-nav-ico">◉</span><span>Yakınımdaki Şehirler</span></button>
        <button class="mob-drawer-btn" onclick="openCompass();closeMobDrawer()"><span class="mob-nav-ico">◎</span><span>Canlı Pusula</span></button>
        <button class="mob-drawer-btn" onclick="openExport();closeMobDrawer()"><span class="mob-nav-ico">↗</span><span>Export ve Paylaş</span></button>
      </div>

      <div class="mob-drawer-section">
        <div class="mob-drawer-section-lbl">Sistem</div>
        <button class="mob-drawer-btn" onclick="openBiz();closeMobDrawer()"><span class="mob-nav-ico">◈</span><span>Gelir ve Paketler</span></button>
        <button class="mob-drawer-btn" onclick="openLab();closeMobDrawer()"><span class="mob-nav-ico">◧</span><span>QA ve Lab</span></button>
        <button class="mob-drawer-btn" id="mob-btn-outdoor" onclick="toggleOutdoorMode();closeMobDrawer()"><span class="mob-nav-ico">☼</span><span>Outdoor Mod</span></button>
      </div>
    </div>

    <div class="mob-drawer-foot">
      <button class="mob-lang-btn" onclick="setLang('tr')">TR</button>
      <button class="mob-lang-btn" onclick="setLang('en')">EN</button>
    </div>
  </div>
</div>

<!-- ══ EXPORT MODAL ════════════════════════════════════════════ -->
<div class="exp-overlay" id="exp-overlay" onclick="expOverlayClick(event)">
  <div class="exp-modal">

    <div class="exp-header">
      <div class="exp-title"> Export & Paylaşım</div>
      <button class="exp-close" onclick="closeExport()"></button>
    </div>

    <!-- Share URL -->
    <div class="exp-section">
      <div class="exp-section-title"> Paylaşılabilir URL</div>
      <div class="exp-url-row">
        <input class="exp-url-input" id="exp-url-input" type="text" readonly/>
        <button class="exp-copy-btn" id="exp-copy-url" onclick="copyShareUrl()">Kopyala</button>
      </div>
      <div class="exp-url-hint">URL'de şehir adı, harita merkezi ve zoom seviyesi kaydedilir. Paylaşılan kişi aynı görünüme gider.</div>
    </div>

    <!-- Summary -->
    <div class="exp-section">
      <div class="exp-section-title"> Mevcut Veri Özeti</div>
      <div class="exp-summary" id="exp-summary"></div>
    </div>

    <!-- Download buttons -->
    <div class="exp-section">
      <div class="exp-section-title"> İndir</div>
      <div class="exp-dl-grid">
        <button class="exp-dl-btn" onclick="exportJSON()">
          <span class="exp-dl-icon">{ }</span>
          <span class="exp-dl-label">JSON</span>
          <span class="exp-dl-desc">Tüm cami verisi</span>
        </button>
        <button class="exp-dl-btn" onclick="exportCSV()">
          <span class="exp-dl-icon">⊞</span>
          <span class="exp-dl-label">CSV</span>
          <span class="exp-dl-desc">Excel uyumlu</span>
        </button>
        <button class="exp-dl-btn" onclick="exportGeoJSON()">
          <span class="exp-dl-icon"></span>
          <span class="exp-dl-label">GeoJSON</span>
          <span class="exp-dl-desc">QGIS / Mapbox</span>
        </button>
        <button class="exp-dl-btn" onclick="exportReport()">
          <span class="exp-dl-icon"></span>
          <span class="exp-dl-label">HTML Rapor</span>
          <span class="exp-dl-desc">Yeni sekmede aç</span>
        </button>
        <button class="exp-dl-btn" onclick="shareScoreCard()">
          <span class="exp-dl-icon"></span>
          <span class="exp-dl-label">Skor Kartı</span>
          <span class="exp-dl-desc">Görsel üret & paylaş</span>
        </button>
      </div>
    </div>

    <div class="exp-footer">
      Veri kaynağı: OpenStreetMap katkıcıları · ODbL lisansı
    </div>
  </div>
</div>

<!-- ══ BUSINESS / MONETIZATION MODAL ═══════════════════════════ -->
<div class="biz-overlay" id="biz-overlay" onclick="bizOverlayClick(event)">
  <div class="biz-modal">
    <div class="biz-header">
      <div class="biz-title"> Gelir Kanalları (Üyeliksiz)</div>
      <button class="biz-close" onclick="closeBiz()"></button>
    </div>

    <div class="biz-section">
      <div class="biz-section-title">Sponsor Alanları (Aylık)</div>
      <div class="biz-grid">
        <div class="biz-card">
          <div class="biz-card-name">Bronz Sponsor</div>
          <div class="biz-card-price">7.500 TL / ay</div>
          <div class="biz-card-desc">Footer + modal içinde görünürlük</div>
        </div>
        <div class="biz-card">
          <div class="biz-card-name">Gümüş Sponsor</div>
          <div class="biz-card-price">15.000 TL / ay</div>
          <div class="biz-card-desc">Sidebar + şehir raporu ekranında görünürlük</div>
        </div>
        <div class="biz-card">
          <div class="biz-card-name">Altın Sponsor</div>
          <div class="biz-card-price">30.000 TL / ay</div>
          <div class="biz-card-desc">Header rozeti + rapor sayfası sponsor etiketi</div>
        </div>
      </div>
      <div class="biz-cta-row">
        <a class="biz-cta" href="mailto:sales@qibla-checker.app?subject=Sponsorluk%20Teklifi">Sponsorluk Talebi</a>
      </div>
    </div>

    <div class="biz-section">
      <div class="biz-section-title">Tek Seferlik Satış</div>
      <div class="biz-inline">
        <span>Kurumsal PDF Rapor</span>
        <strong>2.500 TL</strong>
      </div>
      <div class="biz-inline">
        <span>Toplu Şehir Analizi (10 şehir)</span>
        <strong>12.000 TL</strong>
      </div>
      <div class="biz-cta-row">
        <a class="biz-cta primary" href="https://example.com/odeme-linki" target="_blank" rel="noopener">Ödeme Linki (Demo)</a>
        <button class="biz-cta" onclick="openExport();closeBiz()">Önce Örnek Rapor Gör</button>
      </div>
    </div>

    <div class="biz-section">
      <div class="biz-section-title">B2B / White-Label Talebi</div>
      <div class="biz-form">
        <input id="biz-name" type="text" placeholder="Ad Soyad"/>
        <input id="biz-company" type="text" placeholder="Kurum / Şirket"/>
        <input id="biz-email" type="email" placeholder="E-posta"/>
        <textarea id="biz-msg" placeholder="İhtiyaç: white-label, API, toplu analiz..."></textarea>
        <button class="biz-cta primary" onclick="bizSendLead()">Teklif Maili Oluştur</button>
      </div>
    </div>
  </div>
</div>

<!-- ══ QA / INSIGHTS LAB ══════════════════════════════════════ -->
<div class="lab-overlay" id="lab-overlay" onclick="labOverlayClick(event)">
  <div class="lab-modal">
    <div class="lab-header">
      <div class="lab-title"> QA & İçgörü Laboratuvarı</div>
      <button class="lab-close" onclick="closeLab()"></button>
    </div>
    <div class="lab-grid">
      <div class="lab-card">
        <div class="lab-card-title">Şehir İçgörüsü</div>
        <div id="lab-insights"></div>
      </div>
      <div class="lab-card">
        <div class="lab-card-title">Kalite Kuyruğu</div>
        <div id="lab-queue"></div>
      </div>
      <div class="lab-card">
        <div class="lab-card-title">Sürüm Geçmişi</div>
        <div id="lab-snapshots"></div>
      </div>
    </div>
  </div>
</div>

<!-- ══ LIVE COMPASS ═══════════════════════════════════════════ -->
<div class="cmps-overlay" id="cmps-overlay" onclick="compassOverlayClick(event)">
  <div class="cmps-modal">
    <div class="cmps-header">
      <div class="cmps-title"> Canlı Pusula</div>
      <button class="cmps-close" onclick="closeCompass()"></button>
    </div>
    <div class="cmps-body">
      <canvas id="cmps-canvas" width="260" height="260"></canvas>
      <div class="cmps-rows" id="cmps-rows"></div>
      <div class="cmps-actions">
        <button class="btn btn-sm" onclick="requestCompassPermission()">Sensör İzni</button>
        <button class="btn btn-sm" onclick="refreshCompassLocation()">Konumu Yenile</button>
        <button class="btn btn-sm" id="btn-map-sync" onclick="toggleMapCompassSync()">Haritayı Döndür</button>
      </div>
    </div>
  </div>
</div>

<!-- ══ 3D ANALYSIS ════════════════════════════════════════════ -->
<div class="m3d-overlay" id="m3d-overlay" onclick="m3dOverlayClick(event)">
  <div class="m3d-modal">
    <div class="m3d-header">
      <div class="m3d-title"> 3D Yön Analizi (Deneysel)</div>
      <button class="m3d-close" onclick="close3D()"></button>
    </div>
    <div class="m3d-wrap">
      <canvas id="m3d-canvas"></canvas>
      <div class="m3d-side" id="m3d-side"></div>
    </div>
  </div>
</div>

<!-- ══ KEYBOARD SHORTCUTS ════════════════════════════════════ -->
<div class="ks-overlay" id="ks-overlay" onclick="ksOverlayClick(event)">
  <div class="ks-modal">
    <div class="ks-title">
      ⌨ Klavye Kısayolları
      <button class="ks-close-btn" onclick="closeShortcuts()"></button>
    </div>
    <div class="ks-grid">
      <div class="ks-row"><span class="ks-key">/</span><span class="ks-desc">Şehir arama</span></div>
      <div class="ks-row"><span class="ks-key">Enter</span><span class="ks-desc">Ara / Onayla</span></div>
      <div class="ks-row"><span class="ks-key">Esc</span><span class="ks-desc">Panel / Modal kapat</span></div>
      <div class="ks-row"><span class="ks-key">?</span><span class="ks-desc">Bu yardım ekranı</span></div>
      <div class="ks-row"><span class="ks-key">H</span><span class="ks-desc">Isı haritası</span></div>
      <div class="ks-row"><span class="ks-key">S</span><span class="ks-desc">Skor kartı</span></div>
      <div class="ks-row"><span class="ks-key">T</span><span class="ks-desc">Tarihsel analiz</span></div>
      <div class="ks-row"><span class="ks-key">L</span><span class="ks-desc">Sıralama tablosu</span></div>
      <div class="ks-row"><span class="ks-key">Q</span><span class="ks-desc">QA & lab paneli</span></div>
      <div class="ks-row"><span class="ks-key">O</span><span class="ks-desc">Canlı pusula</span></div>
      <div class="ks-row"><span class="ks-key">P</span><span class="ks-desc">Gelir / paket modalı</span></div>
      <div class="ks-row"><span class="ks-key">G</span><span class="ks-desc">Konumuma git</span></div>
      <div class="ks-row"><span class="ks-key">←</span><span class="ks-desc">Önceki cami</span></div>
      <div class="ks-row"><span class="ks-key">→</span><span class="ks-desc">Sonraki cami</span></div>
      <div class="ks-row"><span class="ks-key">+/-</span><span class="ks-desc">Tolerans artır/azalt</span></div>
      <div class="ks-row"><span class="ks-key">D</span><span class="ks-desc">Detay paneli kapat</span></div>
    </div>
    <div class="ks-footer">Tüm kısayollar — metin girişi aktifken devre dışı</div>
  </div>
</div>

<div class="stats-bar">
  <div class="stat"><div class="dot gold"></div><div class="stat-num" id="s-total">—</div><div class="stat-lbl">Cami</div></div>
  <div class="stat"><div class="dot green"></div><div class="stat-num" id="s-ok">—</div><div class="stat-lbl">Doğru</div></div>
  <div class="stat"><div class="dot red"></div><div class="stat-num" id="s-bad">—</div><div class="stat-lbl">Sapma</div></div>
  <div class="stat"><div class="dot amber"></div><div class="stat-num" id="s-unk">—</div><div class="stat-lbl">Veri Yok</div></div>
  <div class="cache-info">Cache: <span id="cache-count">0</span> tile</div>
  <div class="district-pill" id="district-pill">
    <span id="district-pill-text">—</span>
    <button id="district-pill-clear" title="İlçe filtresini temizle"></button>
  </div>
</div>
<div class="mode-pills">
  <div class="map-switch" id="axis-switch">
    <button id="axis-final" class="active" onclick="setAxisMode('final')">Final</button>
    <button id="axis-raw" onclick="setAxisMode('raw')">Raw</button>
    <button id="axis-interior" onclick="setAxisMode('interior')">Inside</button>
  </div>
</div>
<div class="tolerance-pill">
  <div class="tol">Tolerans:<input type="range" id="tol" min="5" max="45" value="15"><span id="tol-val">15°</span></div>
</div>

<div class="main">
  <div id="map">
    <div class="floating-search">
      <div class="search-box">
        <button class="mob-pill-logo" type="button" aria-label="Ana sayfa" onclick="resetToHome()"><img src="/assets/img/qible.svg" alt="Qible logo"></button>
        <input id="city-input" list="city-suggest-list" type="text" placeholder="Şehir / cami ara..." value=""/>
        <datalist id="city-suggest-list"></datalist>
        <button class="btn" id="search-btn" data-tip="Şehir ara [Enter]">Ara</button>
        <button class="mob-pill-menu" type="button" aria-label="Menü" onclick="openMobDrawer()"></button>
        <div class="city-smart-dd" id="city-smart-dd"></div>
      </div>
    </div>
    <button class="search-area-btn" id="search-area-btn" type="button" onclick="refreshSearchArea()">Bu alanı tara</button>
    <button class="live-vp-badge live-badge idle" id="live-vp-badge" type="button" aria-live="polite" aria-label="Canlı veri durumu">
      <span class="live-vp-icon-wrap">
        <span class="vp-dot" id="vp-dot"></span>
      </span>
      <span class="live-vp-copy">
        <span id="vp-label">Canlı hazır</span>
        <span id="vp-meta">Cache: 0 tile</span>
      </span>
    </button>
    <div class="map-fab">
      <button class="map-fab-btn" onclick="document.getElementById('loc-btn').click()" title="Konumum" aria-label="Konumum">⌖</button>
      <button class="map-fab-btn secondary" onclick="document.getElementById('btn-compass').click()" title="Pusula" aria-label="Pusula">◎</button>
    </div>
    <div class="mob-layer-stack" id="mob-layer-stack">
      <button class="mob-layer-btn active" id="mob-fab-dark" onclick="switchLayer('dark')" aria-label="Koyu harita"> Koyu</button>
      <button class="mob-layer-btn" id="mob-fab-sat" onclick="switchLayer('satellite')" aria-label="Uydu harita"> Uydu</button>
      <button class="mob-layer-btn" id="mob-fab-osm" onclick="switchLayer('osm')" aria-label="Standart harita"> Harita</button>
    </div>
    <button class="compass-fab" id="compass-fab" onclick="toggleLiveMapCompass()" aria-label="Canlı pusula modu"></button>
    <!-- Mini non-blocking loader -->
    <div class="mini-loader" id="mini-loader">
      <div class="mini-spin"></div>
      <span id="mini-text">Yükleniyor...</span>
    </div>
    <!-- Kıble animation info panel -->
    <div class="qibla-panel" id="qibla-panel">
      <div class="qp-name" id="qp-name">—</div>
      <div class="qp-row"><span class="qp-k" style="color:#c9a84c">──</span><span class="qp-v" id="qp-angle" style="font-size:10px">—</span></div>
      <div class="qp-row"><span class="qp-k" style="color:#7c6ad8">──</span><span class="qp-v" id="qp-diff" style="font-size:10px">—</span></div>
      <div class="qp-row"><span class="qp-k">Kabe</span><span class="qp-v" id="qp-dist">—</span></div>
      <div class="qp-anim" id="qp-anim-status">● Kıble çizgisi çiziliyor...</div>
    </div>
    <div class="district-hover-chip" id="district-hover-chip">İlçe modu: harita üzerinde gezdirin</div>

    <!-- Score Card Panel -->
    <div class="score-card" id="score-card">
      <div class="sc-close" onclick="toggleScoreCard()"></div>
      <div class="sc-city" id="sc-city">—</div>
      <div class="sc-score-wrap">
        <canvas id="sc-donut" width="110" height="110"></canvas>
        <div class="sc-score-center">
          <div class="sc-pct" id="sc-pct">—</div>
          <div class="sc-pct-lbl">doğruluk</div>
        </div>
      </div>
      <div class="sc-grade" id="sc-grade"></div>
      <div class="sc-stats">
        <div class="sc-stat-row">
          <span class="sc-dot" style="background:#4ade80"></span>
          <span class="sc-stat-lbl">Doğru yön</span>
          <span class="sc-stat-val" id="sc-ok">—</span>
        </div>
        <div class="sc-stat-row">
          <span class="sc-dot" style="background:#f87171"></span>
          <span class="sc-stat-lbl">Sapma var</span>
          <span class="sc-stat-val" id="sc-bad">—</span>
        </div>
        <div class="sc-stat-row">
          <span class="sc-dot" style="background:#fbbf24"></span>
          <span class="sc-stat-lbl">Veri yok</span>
          <span class="sc-stat-val" id="sc-unk">—</span>
        </div>
        <div class="sc-stat-row" style="border-top:1px solid var(--border);margin-top:6px;padding-top:6px;">
          <span class="sc-stat-lbl" style="color:var(--muted)">Ort. sapma</span>
          <span class="sc-stat-val" id="sc-avg">—</span>
        </div>
        <div class="sc-stat-row">
          <span class="sc-stat-lbl" style="color:var(--muted)">Maks. sapma</span>
          <span class="sc-stat-val" id="sc-max">—</span>
        </div>
        <div class="sc-stat-row">
          <span class="sc-stat-lbl" style="color:var(--muted)">Min. sapma</span>
          <span class="sc-stat-val" id="sc-min">—</span>
        </div>
      </div>
      <div class="sc-best-worst">
        <div class="sc-bw-label">En İyi ↑</div>
        <div class="sc-bw-name" id="sc-best">—</div>
        <div class="sc-bw-label" style="margin-top:6px">En Kötü ↓</div>
        <div class="sc-bw-name" id="sc-worst" style="color:var(--red)">—</div>
      </div>
      <div class="sc-tolerance">Tolerans: <span id="sc-tol-val">15°</span> ile hesaplandı</div>
    </div>
  </div>
  <div class="sidebar">
    <div class="sb-head" id="sb-head-handle">
      <span>Cami Listesi</span>
      <span class="sb-count" id="sb-count"></span>
    </div>
    <div class="sb-snap-panels">
      <div class="sb-mini-panel" id="sb-mini-panel">
        <div class="sb-mini-title">Genel Skor</div>
        <div class="sb-mini-city" id="sb-mini-city">—</div>
        <div class="sb-mini-score" id="sb-mini-score">—</div>
        <div class="sb-mini-sub" id="sb-mini-sub">Veri bekleniyor</div>
      </div>
      <div class="sb-half-panel" id="sb-half-panel">
        <div class="sb-mini-title">İstatistik & Radar</div>
        <div class="sb-half-grid">
          <div class="sb-half-metrics">
            <div class="sb-half-row"><span>Toplam</span><b id="sb-m-total">—</b></div>
            <div class="sb-half-row"><span>Doğruluk</span><b id="sb-m-pct">—</b></div>
            <div class="sb-half-row"><span>Ort. Sapma</span><b id="sb-m-avg">—</b></div>
            <div class="sb-half-row"><span>Maks Sapma</span><b id="sb-m-max">—</b></div>
          </div>
          <canvas id="sb-radar" width="108" height="108"></canvas>
        </div>
      </div>
    </div>
    <div class="ms-wrap" id="ms-wrap">
      <div class="ms-box">
        <span class="ms-icon"></span>
        <input id="mosque-search" type="text" placeholder="Cami adı ara..." autocomplete="off" spellcheck="false"/>
        <button id="ms-clear" onclick="clearMosqueSearch()"></button>
      </div>
      <div class="ms-scope">
        <span class="ms-scope-lbl"><b>Bu alanda ara</b> (harita görünümü)</span>
        <label class="ms-switch" for="ms-scope-only">
          <input id="ms-scope-only" type="checkbox" checked/>
          <span class="ms-switch-track"></span>
        </label>
      </div>
      <div class="ms-dropdown" id="ms-dropdown"></div>
    </div>
    <div class="ms-filter-banner" id="ms-banner">
      <span id="ms-banner-text"></span>
      <button onclick="clearMosqueSearch()"> Filtreyi Kaldır</button>
    </div>
    <div class="pull-refresh" id="sb-pull-indicator">Bırakınca yenilenecek</div>
    <div class="mosque-list" id="mosque-list">
      <div class="empty"><div class="empty-icon"></div><div>Bir şehir arayın</div></div>
    </div>
    <div class="legend">
      <div style="font-size:9px;letter-spacing:.1em;text-transform:uppercase;margin-bottom:3px;">Açıklama</div>
      <div class="leg-row"><div class="leg-line" style="background:#4ade80"></div><span>Kıble yönünde</span></div>
      <div class="leg-row"><div class="leg-line" style="background:#f87171"></div><span>Sapma var</span></div>
      <div class="leg-row"><div class="leg-line" style="background:transparent;border-top:1px dashed #c9a84c;height:0;width:22px"></div><span>Gerçek kıble yönü</span></div>
      <div class="leg-row"><div class="leg-line" style="background:rgba(201,168,76,.6)"></div><span>Bina kıble duvarı</span></div>
      <div class="leg-row"><div class="leg-line" style="background:#7c6ad8"></div><span>Binanın gerçek baktığı yön</span></div>
      <div class="leg-row"><div class="leg-line" style="background:transparent;border-top:2px dashed #c9a84c;height:0;width:22px"></div><span>Kabe'ye büyük daire (doğru)</span></div>
    </div>
  </div>
</div>

<div class="overlay" id="overlay">
  <div class="spinner"></div>
  <div class="ov-text" id="ov-text">Yükleniyor...</div>
  <div class="ov-sub" id="ov-sub"></div>
  <button class="ov-cancel" id="ov-cancel" type="button" onclick="cancelActiveSearch()">İptal</button>
</div>
<div class="toast" id="toast"></div>
<script src="./vendor/leaflet/leaflet.js"></script>



<!-- ══ DETAIL PANEL ════════════════════════════════════════════ -->
<div class="dp-backdrop" id="dp-backdrop" onclick="closeDetailPanel()"></div>
<div class="dp-panel" id="dp-panel">

  <!-- Header -->
  <div class="dp-head">
    <div class="dp-head-left">
      <div class="dp-name" id="dp-name">—</div>
      <div class="dp-name-ar" id="dp-name-ar"></div>
      <div class="dp-place" id="dp-place"></div>
      <div class="dp-coords" id="dp-coords"></div>
    </div>
    <button class="dp-close" onclick="closeDetailPanel()"></button>
  </div>

  <!-- Status ribbon -->
  <div class="dp-ribbon" id="dp-ribbon">
    <div class="dp-ribbon-item" id="dp-status-badge"></div>
    <div class="dp-ribbon-item">
      <span class="dp-ribbon-lbl">Kıble</span>
      <span class="dp-ribbon-val" id="dp-qibla-val">—</span>
    </div>
    <div class="dp-ribbon-item">
      <span class="dp-ribbon-lbl">Bina Yönü</span>
      <span class="dp-ribbon-val" id="dp-axis-val">—</span>
    </div>
    <div class="dp-ribbon-item">
      <span class="dp-ribbon-lbl">Sapma</span>
      <span class="dp-ribbon-val" id="dp-diff-val">—</span>
    </div>
    <div class="dp-ribbon-item">
      <span class="dp-ribbon-lbl">Kabe</span>
      <span class="dp-ribbon-val" id="dp-dist-val">—</span>
    </div>
  </div>

  <!-- Photo -->
  <div class="dp-photo-wrap" id="dp-photo-wrap" style="display:none">
    <img class="dp-photo" id="dp-photo" alt="Cami fotoğrafı"/>
    <div class="dp-photo-credit" id="dp-photo-credit"></div>
  </div>

  <!-- Interior evidence -->
  <div class="dp-section" id="dp-interior-section">
    <div class="dp-section-title">İç Mekan Kanıtı</div>
    <div class="dp-int-gallery" id="dp-int-gallery"></div>
    <div class="dp-int-meta" id="dp-int-meta"></div>
    <div class="dp-int-form">
      <label for="dp-int-axis">Namaz saf/mihrab yönü (0–179°)</label>
      <input id="dp-int-axis" type="range" min="0" max="179" value="90" oninput="document.getElementById('dp-int-axis-val').textContent=this.value+'°'"/>
      <div class="dp-int-axis-val" id="dp-int-axis-val">90°</div>
      <select id="dp-int-conf">
        <option value="0.55">Düşük güven</option>
        <option value="0.75" selected>Orta güven</option>
        <option value="0.9">Yüksek güven</option>
      </select>
      <input id="dp-int-url" type="text" placeholder="Kaynak URL (opsiyonel)"/>
      <input id="dp-int-note" type="text" placeholder="Not (örn: mihrab açıkça görünüyor)"/>
      <button class="dp-action-btn" onclick="saveInteriorEvidence()">İç Mekan Yönünü Kaydet</button>
    </div>
    <div class="dp-int-form">
      <label>Manuel Aks Düzeltme (Harita Üzerinde 2 Nokta)</label>
      <button class="dp-action-btn" id="dp-manual-start" onclick="startManualAxisCapture()">Haritada Aks Çiz</button>
      <button class="dp-action-btn" onclick="cancelManualAxisCapture()">İptal</button>
      <div class="dp-int-meta" id="dp-manual-status">Hazır</div>
    </div>
    <div class="dp-int-ev-list" id="dp-int-ev-list"></div>
  </div>

  <!-- Qibla mini diagram -->
  <div class="dp-section">
    <div class="dp-section-title">Kıble Analizi</div>
    <div class="dp-qibla-row">
      <canvas id="dp-compass" width="120" height="120"></canvas>
      <div class="dp-qibla-stats" id="dp-qibla-stats"></div>
    </div>
  </div>

  <div class="dp-section">
    <div class="dp-section-title">Açıklanabilirlik</div>
    <div class="dp-tags" id="dp-explain"></div>
  </div>

  <!-- Wikipedia summary -->
  <div class="dp-section" id="dp-wiki-section" style="display:none">
    <div class="dp-section-title">Wikipedia</div>
    <div class="dp-wiki-body" id="dp-wiki-body"></div>
    <a class="dp-wiki-link" id="dp-wiki-link" target="_blank" rel="noopener">Wikipedia'da oku →</a>
  </div>

  <!-- OSM Tags -->
  <div class="dp-section">
    <div class="dp-section-title" id="dp-tags-title">OSM Etiketleri</div>
    <div class="dp-tags" id="dp-tags"></div>
  </div>

  <!-- Action buttons -->
  <div class="dp-actions" id="dp-actions"></div>

</div>

<!-- ══ LEADERBOARD MODAL ════════════════════════════════════════ -->
<div class="lb-overlay" id="lb-overlay" onclick="lbOverlayClick(event)">
  <div class="lb-modal" id="lb-modal">

    <div class="lb-header">
      <div class="lb-title"> Küresel Kıble Sıralaması</div>
      <div class="lb-header-right">
        <span class="lb-updated" id="lb-updated"></span>
        <button class="lb-close" onclick="closeLeaderboard()"></button>
      </div>
    </div>

    <!-- Controls bar -->
    <div class="lb-controls">
      <div class="lb-add-wrap">
        <input id="lb-city-input" type="text" placeholder="Şehir ekle... (örn: Konya, Cairo, Lahore)" autocomplete="off"/>
        <button id="lb-add-btn" onclick="lbAddCity()">+ Analiz Et</button>
      </div>
      <div class="lb-mode-row">
        <span class="lb-sort-label">Mod:</span>
        <button class="lb-mode active" data-mode="qibla" onclick="lbSetDataset('qibla')"> Şehir Analizi</button>
        <button class="lb-mode" data-mode="admin" onclick="lbSetDataset('admin')"> İl/State Sayımı</button>
      </div>
      <div class="lb-progress-wrap" id="lb-progress-wrap" style="display:none">
        <div class="lb-progress-bar" id="lb-progress-bar"></div>
        <span class="lb-progress-label" id="lb-progress-label">Analiz ediliyor...</span>
      </div>
      <div class="lb-filters">
        <button class="lb-filter active" data-region="all"   onclick="lbSetRegion('all')"> Tümü</button>
        <button class="lb-filter"        data-region="turkey" onclick="lbSetRegion('turkey')"> Türkiye</button>
        <button class="lb-filter"        data-region="mideast" onclick="lbSetRegion('mideast')"> Orta Doğu</button>
        <button class="lb-filter"        data-region="asia"    onclick="lbSetRegion('asia')"> Güney Asya</button>
        <button class="lb-filter"        data-region="africa"  onclick="lbSetRegion('africa')"> Afrika</button>
        <button class="lb-filter"        data-region="europe"  onclick="lbSetRegion('europe')"> Avrupa</button>
        <button class="lb-filter"        data-region="other"   onclick="lbSetRegion('other')"> Diğer</button>
      </div>
      <div class="lb-sort-row">
        <span class="lb-sort-label">Sırala:</span>
        <button class="lb-sort active" data-sort="pct"   onclick="lbSetSort('pct')">Doğruluk %</button>
        <button class="lb-sort"        data-sort="count" onclick="lbSetSort('count')">Cami Sayısı</button>
        <button class="lb-sort"        data-sort="avg"   onclick="lbSetSort('avg')">Ort. Sapma</button>
        <button class="lb-sort"        data-sort="name"  onclick="lbSetSort('name')">Şehir Adı</button>
      </div>
    </div>

    <!-- Summary strip -->
    <div class="lb-summary" id="lb-summary"></div>

    <!-- Table -->
    <div class="lb-table-wrap">
      <div class="lb-table-head">
        <span class="lbt-rank">#</span>
        <span class="lbt-city" id="lb-h-city">Şehir</span>
        <span class="lbt-bar" id="lb-h-bar">Doğruluk</span>
        <span class="lbt-pct" id="lb-h-pct">%</span>
        <span class="lbt-not" id="lb-h-note">Not</span>
        <span class="lbt-count" id="lb-h-count">Cami</span>
        <span class="lbt-avg" id="lb-h-avg">Ort.Sap.</span>
        <span class="lbt-date">Analiz</span>
        <span class="lbt-act"></span>
      </div>
      <div id="lb-rows"></div>
    </div>

    <div class="lb-footer">
      Veriler <strong>OpenStreetMap</strong> · Şehir merkezi 8km yarıçapı · localStorage'da saklanır
      <button class="lb-clear-btn" onclick="lbClearAll()"> Tümünü Temizle</button>
    </div>
  </div>
</div>

<!-- ══ HISTORY MODAL ══════════════════════════════════════════ -->
<div class="hist-overlay" id="hist-overlay" onclick="histOverlayClick(event)">
  <div class="hist-modal" id="hist-modal">
    <div class="hist-header">
      <div class="hist-title"> Tarihsel Dönem Analizi</div>
      <button class="hist-close" onclick="closeHistoryMode()"></button>
    </div>

    <!-- Period filter chips -->
    <div class="hist-chips" id="hist-chips">
      <button class="hist-chip all active" onclick="filterPeriod('all')" data-period="all">Tümü</button>
      <button class="hist-chip ottoman" onclick="filterPeriod('ottoman')" data-period="ottoman"> Osmanlı <span class="hist-chip-sub">—1922</span></button>
      <button class="hist-chip early" onclick="filterPeriod('early')" data-period="early"> Erken Cum. <span class="hist-chip-sub">1923–50</span></button>
      <button class="hist-chip mid" onclick="filterPeriod('mid')" data-period="mid"> Orta <span class="hist-chip-sub">1951–2000</span></button>
      <button class="hist-chip modern" onclick="filterPeriod('modern')" data-period="modern"> Modern <span class="hist-chip-sub">2001+</span></button>
      <button class="hist-chip unknown" onclick="filterPeriod('unknown')" data-period="unknown"> Tarihi Bilinmiyor</button>
    </div>

    <!-- Summary cards row -->
    <div class="hist-cards" id="hist-cards"></div>

    <!-- Bar chart canvas -->
    <div class="hist-chart-wrap">
      <div class="hist-section-label">Döneme Göre Doğruluk Karşılaştırması</div>
      <canvas id="hist-chart" height="140"></canvas>
    </div>

    <!-- Scatter: inşaat yılı vs sapma -->
    <div class="hist-scatter-wrap">
      <div class="hist-section-label">İnşaat Yılı × Kıble Sapması <span style="color:#6b6b7a;font-size:9px">(veri olan camiler)</span></div>
      <canvas id="hist-scatter" height="160"></canvas>
      <div class="hist-scatter-legend">
        <span class="hsl-dot ottoman"></span>Osmanlı &nbsp;
        <span class="hsl-dot early"></span>Erken Cum. &nbsp;
        <span class="hsl-dot mid"></span>Orta &nbsp;
        <span class="hsl-dot modern"></span>Modern
      </div>
    </div>

    <!-- Detail table -->
    <div class="hist-table-wrap">
      <div class="hist-section-label">Dönem Detay Tablosu</div>
      <div id="hist-table"></div>
    </div>

    <!-- Filtered list -->
    <div class="hist-list-wrap">
      <div class="hist-section-label" id="hist-list-label">Seçili dönemdeki camiler</div>
      <div class="hist-list" id="hist-list"></div>
    </div>

    <div class="hist-footer">
      OSM <code>start_date</code> / <code>building:start_date</code> tag verisi · Tarihi olmayan camiler "bilinmiyor" kategorisinde
    </div>
  </div>
</div>

<!-- ══ COMPARISON MODAL ══════════════════════════════════════ -->
<div class="cmp-overlay" id="cmp-overlay" onclick="cmpOverlayClick(event)">
  <div class="cmp-modal" id="cmp-modal">
    <div class="cmp-header">
      <div class="cmp-title"> Şehir Karşılaştırması</div>
      <button class="cmp-close" onclick="closeCompare()"></button>
    </div>
    <div class="cmp-inputs">
      <div class="cmp-city-col">
        <div class="cmp-city-label" style="color:#60a5fa">Şehir A</div>
        <div class="cmp-search-row">
          <input id="cmp-a-input" type="text" placeholder="Şehir/ilçe adı girin..." autocomplete="off"/>
          <select id="cmp-a-level">
            <option value="city">Şehir</option>
            <option value="district">İlçe</option>
          </select>
        </div>
        <div class="cmp-search-row">
          <button class="btn" id="cmp-a-fetch-btn" onclick="fetchCompareSide('a')">Yükle</button>
          <button class="btn btn-sm" id="cmp-a-clear-btn" onclick="clearCompareSide('a')">Kaldır</button>
        </div>
        <div class="cmp-city-current" id="cmp-a-name">—</div>
        <div class="cmp-city-status" id="cmp-a-status"></div>
      </div>
      <div class="cmp-vs">VS</div>
      <div class="cmp-city-col">
        <div class="cmp-city-label" style="color:#f472b6">Şehir B</div>
        <div class="cmp-search-row">
          <input id="cmp-b-input" type="text" placeholder="Şehir/ilçe adı girin..." autocomplete="off"/>
          <select id="cmp-b-level">
            <option value="city">Şehir</option>
            <option value="district">İlçe</option>
          </select>
        </div>
        <div class="cmp-search-row">
          <button class="btn" id="cmp-b-fetch-btn" onclick="fetchCompareSide('b')">Yükle</button>
          <button class="btn btn-sm" id="cmp-b-clear-btn" onclick="clearCompareSide('b')">Kaldır</button>
        </div>
        <div class="cmp-city-current" id="cmp-b-name">—</div>
        <div class="cmp-city-status" id="cmp-b-status"></div>
      </div>
    </div>
    <div class="cmp-progress-wrap" id="cmp-progress-wrap" style="display:none">
      <div class="cmp-progress-bar" id="cmp-progress-bar"></div>
      <div class="cmp-progress-label" id="cmp-progress-label">Yükleniyor...</div>
    </div>
    <div class="cmp-results" id="cmp-results" style="display:none">
      <div class="cmp-score-row">
        <div class="cmp-score-block cmp-a-bg">
          <div class="cmp-score-pct" id="cmp-a-pct">—</div>
          <canvas id="cmp-a-donut" width="80" height="80"></canvas>
          <div class="cmp-score-grade" id="cmp-a-grade"></div>
          <div class="cmp-score-city" id="cmp-a-label">—</div>
        </div>
        <div class="cmp-winner-col">
          <div class="cmp-winner-badge" id="cmp-winner-badge"></div>
          <canvas id="cmp-radar" width="200" height="200"></canvas>
          <div class="cmp-radar-legend">
            <span class="cmp-leg-a">■</span> A &nbsp;
            <span class="cmp-leg-b">■</span> B
          </div>
        </div>
        <div class="cmp-score-block cmp-b-bg">
          <div class="cmp-score-pct" id="cmp-b-pct">—</div>
          <canvas id="cmp-b-donut" width="80" height="80"></canvas>
          <div class="cmp-score-grade" id="cmp-b-grade"></div>
          <div class="cmp-score-city" id="cmp-b-label">—</div>
        </div>
      </div>
      <div class="cmp-bars-section">
        <div class="cmp-section-label">Metrik Karşılaştırması</div>
        <div id="cmp-bars"></div>
      </div>
      <div class="cmp-table-section">
        <div class="cmp-section-label">Özet Tablo</div>
        <div id="cmp-table"></div>
      </div>
    </div>
    <div class="cmp-footer">Tolerans: <span id="cmp-tol">15°</span> · OSM verisi</div>
  </div>
</div>













<script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>
<script src="./assets/js/app.js"></script>
</body>
</html>
